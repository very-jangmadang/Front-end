# ë°±ì—”ë“œ ì¿ í‚¤ ì‚­ì œ ìˆ˜ì • ê°€ì´ë“œ

## ğŸš¨ í˜„ì¬ ë¬¸ì œ
- ë¡œê·¸ì•„ì›ƒ APIëŠ” ì„±ê³µ (200 ì‘ë‹µ)
- í•˜ì§€ë§Œ ì¿ í‚¤ê°€ ì‚­ì œë˜ì§€ ì•ŠìŒ (`cookiesAfterResponse: ''`)
- ë¡œê·¸ì•„ì›ƒ í›„ ë°”ë¡œ ë‹¤ì‹œ ë¡œê·¸ì¸ë¨

## ğŸ”§ í•´ê²° ë°©ë²•

### 1. ë¡œê·¸ì•„ì›ƒ API ìˆ˜ì • (UserController.java)

**í˜„ì¬ ë¬¸ì œê°€ ìˆëŠ” ì½”ë“œ:**
```java
@PostMapping("/api/permit/logout")
public ResponseEntity<?> logout(HttpServletRequest request, HttpServletResponse response) {
    // ì„¸ì…˜ë§Œ ë¬´íš¨í™”í•˜ê³  ì¿ í‚¤ëŠ” ì‚­ì œí•˜ì§€ ì•ŠìŒ
    HttpSession session = request.getSession(false);
    if (session != null) {
        session.invalidate();
    }
    
    return ResponseEntity.ok(Map.of(
        "isSuccess", true,
        "code", "USER_2004", 
        "message", "ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒí•˜ì˜€ìŠµë‹ˆë‹¤."
    ));
}
```

**ìˆ˜ì •ëœ ì½”ë“œ:**
```java
@PostMapping("/api/permit/logout")
public ResponseEntity<?> logout(HttpServletRequest request, HttpServletResponse response) {
    try {
        // 1. ì„¸ì…˜ ë¬´íš¨í™”
        HttpSession session = request.getSession(false);
        if (session != null) {
            session.invalidate();
        }
        
        // 2. ëª¨ë“  ê´€ë ¨ ì¿ í‚¤ ì‚­ì œ (í¬ë¡œìŠ¤ë„ë©”ì¸ìš©)
        String[] cookieNames = {"JSESSIONID", "access", "refresh", "idtoken"};
        
        for (String cookieName : cookieNames) {
            // ë°©ë²• 1: ë„ë©”ì¸ ì—†ì´ ì‚­ì œ (í¬ë¡œìŠ¤ë„ë©”ì¸ì—ì„œ ì‘ë™)
            Cookie cookie = new Cookie(cookieName, null);
            cookie.setPath("/");
            cookie.setMaxAge(0);
            cookie.setHttpOnly(true);
            cookie.setSecure(true);
            response.addCookie(cookie);
            
            // ë°©ë²• 2: ì—¬ëŸ¬ ë„ë©”ì¸ì—ì„œ ì‚­ì œ ì‹œë„
            Cookie domainCookie = new Cookie(cookieName, null);
            domainCookie.setDomain(".jangmadang.site");
            domainCookie.setPath("/");
            domainCookie.setMaxAge(0);
            domainCookie.setHttpOnly(true);
            domainCookie.setSecure(true);
            response.addCookie(domainCookie);
            
            // ë°©ë²• 3: í˜„ì¬ ë„ë©”ì¸ì—ì„œë„ ì‚­ì œ
            Cookie currentCookie = new Cookie(cookieName, null);
            currentCookie.setPath("/");
            currentCookie.setMaxAge(0);
            currentCookie.setHttpOnly(true);
            currentCookie.setSecure(true);
            response.addCookie(currentCookie);
        }
        
        // 3. ì‘ë‹µ í—¤ë”ì— ì¿ í‚¤ ì‚­ì œ ëª…ì‹œ
        response.setHeader("Set-Cookie", 
            "JSESSIONID=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; Secure; SameSite=None, " +
            "access=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; Secure; SameSite=None, " +
            "refresh=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; Secure; SameSite=None, " +
            "idtoken=; Path=/; Expires=Thu, 01 Jan 1970 00:00:00 GMT; HttpOnly; Secure; SameSite=None"
        );
        
        return ResponseEntity.ok(Map.of(
            "isSuccess", true,
            "code", "USER_2004", 
            "message", "ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒí•˜ì˜€ìŠµë‹ˆë‹¤."
        ));
        
    } catch (Exception e) {
        return ResponseEntity.status(500).body(Map.of(
            "isSuccess", false,
            "message", "ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
        ));
    }
}
```

### 2. Spring Boot ì„¸ì…˜ ì„¤ì • í™•ì¸

**application.properties:**
```properties
# ì„¸ì…˜ ì¿ í‚¤ ì„¤ì •
server.servlet.session.cookie.path=/
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=none
# server.servlet.session.cookie.domain=.jangmadang.site  # í¬ë¡œìŠ¤ë„ë©”ì¸ì—ì„œëŠ” ì œê±°
```

### 3. CORS ì„¤ì • í™•ì¸

**WebConfig.java:**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOrigins(
                "https://jangmadang.site",
                "https://www.jangmadang.site", 
                "https://jmd-fe.vercel.app"
            )
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .allowCredentials(true)
            .exposedHeaders("Set-Cookie") // ì¿ í‚¤ í—¤ë” ë…¸ì¶œ
            .maxAge(3600);
    }
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

1. **ë°±ì—”ë“œ ìˆ˜ì • í›„ ì¬ë°°í¬**
2. **ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ ì™„ì „ ì‚­ì œ**
3. **https://jmd-fe.vercel.appì—ì„œ ë¡œê·¸ì¸**
4. **ë¡œê·¸ì•„ì›ƒ ë²„íŠ¼ í´ë¦­**
5. **ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ Set-Cookie í—¤ë” í™•ì¸**
6. **ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸ ì‹œë„**

## ğŸ“‹ í™•ì¸ ì‚¬í•­

- [ ] ë¡œê·¸ì•„ì›ƒ APIì—ì„œ ëª¨ë“  ì¿ í‚¤ë¥¼ ì‚­ì œí•˜ëŠ” ì½”ë“œ ì¶”ê°€
- [ ] Set-Cookie í—¤ë”ì— ì¿ í‚¤ ì‚­ì œ ëª…ì‹œ
- [ ] CORS ì„¤ì •ì— `exposedHeaders: "Set-Cookie"` ì¶”ê°€
- [ ] ì—¬ëŸ¬ ë„ë©”ì¸ì—ì„œ ì¿ í‚¤ ì‚­ì œ ì‹œë„

## ğŸ¯ ì˜ˆìƒ ê²°ê³¼

ìˆ˜ì • í›„:
- ë¡œê·¸ì•„ì›ƒ ì‹œ ëª¨ë“  ì¿ í‚¤ê°€ ì œëŒ€ë¡œ ì‚­ì œë¨
- `cookiesAfterResponse: ''` ëŒ€ì‹  ì‹¤ì œ ì¿ í‚¤ ì‚­ì œ í™•ì¸ ê°€ëŠ¥
- ë¡œê·¸ì•„ì›ƒ í›„ ë‹¤ì‹œ ë¡œê·¸ì¸ë˜ì§€ ì•ŠìŒ 