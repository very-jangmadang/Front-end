# ë°±ì—”ë“œ ì¿ í‚¤ ì„¤ì • ìˆ˜ì • ê°€ì´ë“œ

## ğŸš¨ í˜„ì¬ ë¬¸ì œ
- `jangmadang.site`ì—ì„œëŠ” ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì´ ì •ìƒ ì‘ë™
- `jmd-fe.vercel.app`ì—ì„œëŠ” ì¿ í‚¤ê°€ ì „ì†¡ë˜ì§€ ì•Šì•„ ì„¸ì…˜ì´ nullë¡œ ì „ë‹¬ë¨

## ğŸ”§ í•´ê²° ë°©ë²•

### 1. ì¿ í‚¤ ë„ë©”ì¸ ì„¤ì • ìˆ˜ì •

**í˜„ì¬ ì„¤ì • (ë¬¸ì œ):**
```java
// í˜„ì¬: api.jangmadang.site ë„ë©”ì¸ìœ¼ë¡œë§Œ ì„¤ì •
Cookie cookie = new Cookie("JSESSIONID", sessionId);
cookie.setDomain("api.jangmadang.site"); // âŒ ë¬¸ì œ
```

**ìˆ˜ì •ëœ ì„¤ì •:**
```java
// ìˆ˜ì •: ê³µí†µ ë„ë©”ì¸ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ëª¨ë“  ì„œë¸Œë„ë©”ì¸ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
Cookie cookie = new Cookie("JSESSIONID", sessionId);
cookie.setDomain(".jangmadang.site"); // âœ… í•´ê²° (ì ìœ¼ë¡œ ì‹œì‘)
```

### 2. Spring Boot ì„¸ì…˜ ì„¤ì •

**application.properties ë˜ëŠ” application.yml:**
```properties
# ì„¸ì…˜ ì¿ í‚¤ ì„¤ì •
server.servlet.session.cookie.domain=.jangmadang.site
server.servlet.session.cookie.path=/
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=none
```

### 3. CORS ì„¤ì • í™•ì¸

**WebConfig.java ë˜ëŠ” SecurityConfig.java:**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOrigins(
                "https://jangmadang.site",
                "https://www.jangmadang.site", 
                "https://jmd-fe.vercel.app",
                "https://api.jangmadang.site"
            )
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .allowCredentials(true)
            .maxAge(3600);
    }
}
```

### 4. ë¡œê·¸ì•„ì›ƒ ì‹œ ì¿ í‚¤ ì‚­ì œ

**UserController.javaì˜ logout ë©”ì„œë“œ:**
```java
@PostMapping("/api/permit/logout")
public ResponseEntity<?> logout(HttpServletRequest request, HttpServletResponse response) {
    try {
        // 1. ì„¸ì…˜ ë¬´íš¨í™”
        HttpSession session = request.getSession(false);
        if (session != null) {
            session.invalidate();
        }
        
        // 2. ëª¨ë“  ê´€ë ¨ ì¿ í‚¤ ì‚­ì œ (ì—¬ëŸ¬ ë„ë©”ì¸ì—ì„œ)
        String[] cookieNames = {"JSESSIONID", "access", "refresh", "idtoken"};
        
        for (String cookieName : cookieNames) {
            // .jangmadang.site ë„ë©”ì¸ì—ì„œ ì‚­ì œ
            Cookie cookie = new Cookie(cookieName, null);
            cookie.setDomain(".jangmadang.site");
            cookie.setPath("/");
            cookie.setMaxAge(0);
            cookie.setHttpOnly(true);
            cookie.setSecure(true);
            response.addCookie(cookie);
            
            // ì¶”ê°€ë¡œ í˜„ì¬ ë„ë©”ì¸ì—ì„œë„ ì‚­ì œ
            Cookie localCookie = new Cookie(cookieName, null);
            localCookie.setPath("/");
            localCookie.setMaxAge(0);
            localCookie.setHttpOnly(true);
            localCookie.setSecure(true);
            response.addCookie(localCookie);
        }
        
        return ResponseEntity.ok(Map.of(
            "isSuccess", true,
            "code", "USER_2004", 
            "message", "ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒí•˜ì˜€ìŠµë‹ˆë‹¤."
        ));
        
    } catch (Exception e) {
        return ResponseEntity.status(500).body(Map.of(
            "isSuccess", false,
            "message", "ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
        ));
    }
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

1. **ë°±ì—”ë“œ ìˆ˜ì • í›„ ì¬ë°°í¬**
2. **ë¸Œë¼ìš°ì €ì—ì„œ ì¿ í‚¤ ì™„ì „ ì‚­ì œ**
3. **https://jmd-fe.vercel.appì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**
4. **ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ ì¿ í‚¤ ì „ì†¡ í™•ì¸**

## ğŸ“‹ í™•ì¸ ì‚¬í•­

- [ ] ì¿ í‚¤ ë„ë©”ì¸ì´ `.jangmadang.site`ë¡œ ì„¤ì •ë¨
- [ ] CORS ì„¤ì •ì— `jmd-fe.vercel.app` í¬í•¨ë¨
- [ ] `allowCredentials: true` ì„¤ì •ë¨
- [ ] ë¡œê·¸ì•„ì›ƒ ì‹œ ëª¨ë“  ë„ë©”ì¸ì—ì„œ ì¿ í‚¤ ì‚­ì œë¨

## ğŸ¯ ì˜ˆìƒ ê²°ê³¼

ìˆ˜ì • í›„:
- `jmd-fe.vercel.app`ì—ì„œë„ ì¿ í‚¤ê°€ ì •ìƒì ìœ¼ë¡œ ì „ì†¡ë¨
- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì´ ëª¨ë“  ë„ë©”ì¸ì—ì„œ ì •ìƒ ì‘ë™
- ì„¸ì…˜ì´ nullë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ 