# í¬ë¡œìŠ¤ë„ë©”ì¸ ì¿ í‚¤ ë¬¸ì œ í•´ê²° ë°©ì•ˆ

## ğŸš¨ í˜„ì¬ ìƒí™©
- `jangmadang.site` (ë©”ì¸ ë„ë©”ì¸)
- `jmd-fe.vercel.app` (ì™„ì „íˆ ë‹¤ë¥¸ ë„ë©”ì¸ - Vercel)
- **ì„œë¸Œë„ë©”ì¸ì´ ì•„ë‹Œ í¬ë¡œìŠ¤ë„ë©”ì¸ í™˜ê²½**

## ğŸ”§ í•´ê²° ë°©ì•ˆ

### ë°©ì•ˆ 1: ë°±ì—”ë“œì—ì„œ ì¿ í‚¤ ë„ë©”ì¸ì„ nullë¡œ ì„¤ì •

**UserController.javaì—ì„œ ì¿ í‚¤ ì„¤ì •:**
```java
// ë¡œê·¸ì¸ ì‹œ ì¿ í‚¤ ì„¤ì •
Cookie sessionCookie = new Cookie("JSESSIONID", sessionId);
// sessionCookie.setDomain(".jangmadang.site"); // âŒ ì œê±°
sessionCookie.setPath("/");
sessionCookie.setHttpOnly(true);
sessionCookie.setSecure(true);
sessionCookie.setMaxAge(24 * 60 * 60); // 24ì‹œê°„
response.addCookie(sessionCookie);

// JWT í† í° ì¿ í‚¤ë„ ë™ì¼í•˜ê²Œ
Cookie accessCookie = new Cookie("access", accessToken);
// accessCookie.setDomain(".jangmadang.site"); // âŒ ì œê±°
accessCookie.setPath("/");
accessCookie.setHttpOnly(true);
accessCookie.setSecure(true);
accessCookie.setMaxAge(60 * 60); // 1ì‹œê°„
response.addCookie(accessCookie);
```

### ë°©ì•ˆ 2: application.properties ì„¤ì •

```properties
# ì„¸ì…˜ ì¿ í‚¤ ì„¤ì • (ë„ë©”ì¸ ì œê±°)
server.servlet.session.cookie.path=/
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=true
server.servlet.session.cookie.same-site=none
# server.servlet.session.cookie.domain=.jangmadang.site  # âŒ ì£¼ì„ ì²˜ë¦¬
```

### ë°©ì•ˆ 3: CORS ì„¤ì • ê°•í™”

**WebConfig.java:**
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
            .allowedOriginPatterns("*") // ëª¨ë“  ë„ë©”ì¸ í—ˆìš© (ê°œë°œìš©)
            // ë˜ëŠ” íŠ¹ì • ë„ë©”ì¸ë§Œ í—ˆìš©
            // .allowedOrigins(
            //     "https://jangmadang.site",
            //     "https://www.jangmadang.site", 
            //     "https://jmd-fe.vercel.app"
            // )
            .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
            .allowedHeaders("*")
            .allowCredentials(true)
            .maxAge(3600);
    }
}
```

### ë°©ì•ˆ 4: ë¡œê·¸ì•„ì›ƒ ì‹œ ì¿ í‚¤ ì‚­ì œ (í¬ë¡œìŠ¤ë„ë©”ì¸ìš©)

```java
@PostMapping("/api/permit/logout")
public ResponseEntity<?> logout(HttpServletRequest request, HttpServletResponse response) {
    try {
        // 1. ì„¸ì…˜ ë¬´íš¨í™”
        HttpSession session = request.getSession(false);
        if (session != null) {
            session.invalidate();
        }
        
        // 2. ëª¨ë“  ê´€ë ¨ ì¿ í‚¤ ì‚­ì œ (ë„ë©”ì¸ ì—†ì´)
        String[] cookieNames = {"JSESSIONID", "access", "refresh", "idtoken"};
        
        for (String cookieName : cookieNames) {
            // ë„ë©”ì¸ ì—†ì´ ì‚­ì œ (í¬ë¡œìŠ¤ë„ë©”ì¸ì—ì„œ ì‘ë™)
            Cookie cookie = new Cookie(cookieName, null);
            // cookie.setDomain(".jangmadang.site"); // âŒ ì œê±°
            cookie.setPath("/");
            cookie.setMaxAge(0);
            cookie.setHttpOnly(true);
            cookie.setSecure(true);
            response.addCookie(cookie);
        }
        
        return ResponseEntity.ok(Map.of(
            "isSuccess", true,
            "code", "USER_2004", 
            "message", "ì„±ê³µì ìœ¼ë¡œ ë¡œê·¸ì•„ì›ƒí•˜ì˜€ìŠµë‹ˆë‹¤."
        ));
        
    } catch (Exception e) {
        return ResponseEntity.status(500).body(Map.of(
            "isSuccess", false,
            "message", "ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."
        ));
    }
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ ë°©ë²•

1. **ë°±ì—”ë“œì—ì„œ ì¿ í‚¤ ë„ë©”ì¸ ì„¤ì • ì œê±°**
2. **ë¸Œë¼ìš°ì € ì¿ í‚¤ ì™„ì „ ì‚­ì œ**
3. **https://jmd-fe.vercel.appì—ì„œ ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸**
4. **ë„¤íŠ¸ì›Œí¬ íƒ­ì—ì„œ Set-Cookie í—¤ë” í™•ì¸**

## ğŸ“‹ í™•ì¸ ì‚¬í•­

- [ ] ì¿ í‚¤ ë„ë©”ì¸ ì„¤ì •ì´ ì œê±°ë¨ (null)
- [ ] CORS ì„¤ì •ì— `jmd-fe.vercel.app` í¬í•¨ë¨
- [ ] `allowCredentials: true` ì„¤ì •ë¨
- [ ] `sameSite: 'none'` ì„¤ì •ë¨

## ğŸ¯ ì˜ˆìƒ ê²°ê³¼

ìˆ˜ì • í›„:
- `jmd-fe.vercel.app`ì—ì„œë„ ì¿ í‚¤ê°€ ì •ìƒì ìœ¼ë¡œ ì„¤ì •ë¨
- ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì´ ëª¨ë“  ë„ë©”ì¸ì—ì„œ ì •ìƒ ì‘ë™
- ì„¸ì…˜ì´ nullë¡œ ì „ë‹¬ë˜ì§€ ì•ŠìŒ

## âš ï¸ ì£¼ì˜ì‚¬í•­

- **SameSite=None**ì€ **Secure=true**ì™€ í•¨ê»˜ ì‚¬ìš©í•´ì•¼ í•¨
- **HTTPS í™˜ê²½ì—ì„œë§Œ ì‘ë™**í•¨
- **ë¸Œë¼ìš°ì € ë³´ì•ˆ ì •ì±…**ì— ë”°ë¼ ì¼ë¶€ ì œí•œì´ ìˆì„ ìˆ˜ ìˆìŒ 